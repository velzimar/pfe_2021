{% extends 'base.html.twig' %}

{% block title %}Mes products{% endblock %}

{% block  breadcrumb %}

    <ul class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="#">Accueil</a></li>
        <li class="breadcrumb-item">
            <a href="#">Commandes</a></li>
    </ul>
{% endblock %}

{% block QuickLink1 %}
    {# { include('product/_myQuickLinks.html.twig') }} #}
{% endblock %}
{% block body %}
    <div class="element-wrapper">
        <h6 class="element-header">
            Les commandes des produits
        </h6>


        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">{#
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

        <script>
            $( function() {
                $( ".widget input[type=submit], .widget a, .widget button" ).button();
                $( "button, input, a" ).click( function( event ) {
                    event.preventDefault();
                } );
            } );
        </script>#}

        <div class="widget">
            <a id="btn-all" class="ui-button ui-corner-all ui-widget"  href="{{ path('myReceivedOrderProducts_status',{'status':'Tous'}) }}">Tous</a>
            <a id="btn-En attente" class="ui-button ui-corner-all ui-widget" href="{{ path('myReceivedOrderProducts_status',{'status':'Attente'}) }}">En attente</a>
            <a id="btn-Livrer" class="ui-button ui-corner-all ui-widget" href="{{ path('myReceivedOrderProducts_status',{'status':'Livrer'}) }}">Livrer</a>
            <a id="btn-Annuler" class="ui-button ui-corner-all ui-widget" href="{{ path('myReceivedOrderProducts_status',{'status':'Annuler'}) }}">Annuler</a>
            <a id="btn-Prêt" class="ui-button ui-corner-all ui-widget" href="{{ path('myReceivedOrderProducts_status',{'status':'Pret'}) }}">Prêt</a>
{#
            <input type="submit" value="A submit button" class="ui-button ui-corner-all ui-widget" role="button">

            <a href="#" class="ui-button ui-corner-all ui-widget" role="button">An anchor</a>
#}
        </div>

        <h6 class="element-description">
        </h6>
        <div class="element-box">
            <div class="order-box">
                <div class="order-items-table">
                    <div class="table-responsive">
                        <table id="dataTable" class="table table-lightborder">
                            <thead id="head">
                            <tr>
                                <th>
                                    Identifiant
                                </th>
                                <th>
                                    Client
                                </th>
                                <th>
                                    Téléphone
                                </th>
                                <th>
                                    Livraison
                                </th>
                                <th>
                                    Date
                                </th>
                                <th>
                                    Total(dt)
                                </th>

                                <th>
                                    Status
                                </th>

                                <th>
                                    Produits
                                </th>

                            </tr>
                            </thead>
                            <tbody>
                            {% for product in products %}
                                <tr>
                                    <td  class="product-name">
                                            {{ product.id }}
                                    </td>

                                    <td  class="product-name">
                                            {{ product.client.email }}
                                    </td>

                                    <td  class="product-name">
                                            {{ product.phone }}
                                    </td>
                                    <td  class="product-name">
                                            {%  if product.delivery == "" %}
                                                Non
                                            {%  else %}
                                                {{ product.delivery }}
                                            {% endif %}
                                    </td>
                                    <td  class="product-name">
                                            {{ product.orderDate |format_datetime('short', 'short', locale='fr') }}

                                    </td>

                                    <td  class="product-name">
                                            {{ product.total }}
                                    </td>

                                    <td>
                                        <div class="product-name">
                                            <select class="select-status-{{ product.id }}" name="{{ product.id }}" disabled>
                                                <option value="{{ product.id }}-En attente" {% if product.status == 'En attente' %} selected {% endif %}>En attente</option>
                                                <option value="{{ product.id }}-Annuler" {% if product.status == 'Annuler' %} selected {% endif %}>Annuler</option>
                                                <option value="{{ product.id }}-Prêt" {% if product.status == 'Prêt' %} selected {% endif %}>Prêt</option>
                                                <option value="{{ product.id }}-Livrer" {% if product.status == 'Livrer' %} selected {% endif %}>Livrer</option>
                                            </select>
                                        </div>
                                    </td>
                                    <td>
                                        <a href="{{ path('myReceivedSubOrderProducts_status',{'status':'Tous','orderId':product.id}) }}">Produits</a>
                                    </td>
                                    {#
                                    <td>
                                        <div class="product-name">
                                            <a class="product-remove-btn"
                                               href="{{ path('myProducts_show', {'id': product.product.id}) }}">
                                                <div class="product-name">
                                                    {{ product.product.id }}
                                                </div>
                                            </a>
                                        </div>
                                    </td>



                                    <td>
                                        <div class="product-name">
                                            {% if product.isUsed %}
                                            <div class="product-name">
                                                Utiliser
                                            </div>
                                            {% else %}
                                                <a class="btn btn-dark" href="{{ path('setIsUsed_orderProduct', {'id': product.id}) }}">Confirmer</a>
                                                {% endif %}
                                        </div>
                                    </td>
                                    #}
                                </tr>
                            {% endfor %}
                            </tbody>
                            <tfoot>
                            <tr>
                                <th>
                                    Identifiant
                                </th>
                                <th>
                                    Client
                                </th>
                                <th>
                                    Téléphone
                                </th>
                                <th>
                                    Livraison
                                </th>
                                <th>
                                    Date
                                </th>
                                <th>
                                    Total(dt)
                                </th>
                            </tr>
                            </tfoot>
                        </table>

                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        let status;
        let id;
        $("select[class^='select-status']").change(function (e) {
            //alert("am clicked")
            e.preventDefault();

            status = $(this).children("option").filter(":selected").text();
            //status = $( ".select-status option:selected" ).text();
            console.log(status)
            id = $(this).attr("name");
            console.log(id);
            $.ajax({
                type: 'PUT',
                url: "/orderProduct/changeStatus/",
                data: {id: id, status: status},
                success: function () {
                    window.location.href = window.location.href
                    console.log('success');
                }
            });
        });


            $(document).ready(function() {
                    $("select").prop("disabled", false);
                $("#all").click()
                $('#dataTable').DataTable( {
                    orderCellsTop: true,
                    fixedHeader: true,
                    "dom": '<"top"l>rt<"bottom"ip><"clear">',
                    language: {
                        url: '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/French.json'
                    },
                    initComplete: function () {
                        this.api().columns().every( function () {
                            var column = this;
                            var select = $('<select><option value=""></option></select>')
                                .appendTo( $(column.footer()).empty() )
                                .on( 'change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                    );

                                    column
                                        .search( val ? '^'+val+'$' : '', true, false )
                                        .draw();
                                } );

                            column.data().unique().sort().each( function ( d, j ) {
                                select.append( '<option value="'+d+'">'+d+'</option>' )
                            } );
                        } );
                    }
                } );
            } );










            // Setup - add a text input to each footer cell
            /*
            $('#dataTable thead tr').clone(true).appendTo('#dataTable thead');
            $('#dataTable thead tr:eq(1) th').each(function (i) {

                var title = $(this).text();
                if(title.search("Product")!==-1 ||title.search("Code")!==-1 ||title.search("Client")!==-1){
                    $(this).html('<input class="form-control" type="text" />');

                    $('input', this).on('keyup change', function () {
                        if (table.column(i).search() !== this.value) {
                            table
                                .column(i)
                                .search(this.value)
                                .draw();
                        }
                    });
                }else{
                    $(this).html('<input type="text" hidden/>');

                }

            });

            var table = $('#dataTable').DataTable({
                orderCellsTop: true,
                fixedHeader: true,
                "dom": '<"top"l>rt<"bottom"ip><"clear">',
                language: {
                    url: '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/French.json'
                }
            });
*/


        /*
        $(document).ready(function () {
            $('#dataTable').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/French.json'
                }
            });
        });*/
    </script>
{% endblock %}
